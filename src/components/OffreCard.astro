---
import PbImage from './PbImage.astro';
import favoriteSvg from '../assets/favorite.svg';

interface Props {
    offre: any;
}

const { offre }: Props = Astro.props;
---

<div class="offre-card rounded-xl p-4 shadow-md" id={"card-" + offre.id} style={offre.favori ? 'background-color: #fef3c7; border: 2px solid #f59e0b' : 'background-color: white; border: 2px solid #d1d5db'}>
    <div>
        <h3 class="font-bold">{offre.nomMaison}</h3>
        <button class="favori-btn" data-id={offre.id} data-favori={offre.favori?.toString() || 'false'} style="background: none; border: none; cursor: pointer; padding: 0;">
            <img src={favoriteSvg.src} alt="Favori" style={`width: 24px; height: 24px; filter: ${offre.favori ? 'invert(72%) sepia(94%) saturate(1500%) hue-rotate(8deg)' : 'brightness(0)'}`} />
        </button>
    </div>
    {offre.images && offre.images[0] && (
        <PbImage record={offre} recordImage={offre.images[0]} />
    )}
</div>

<script>
    const buttons = document.querySelectorAll('.favori-btn') as NodeListOf<HTMLElement>;
    
    buttons.forEach(btn => {
        btn.addEventListener('click', () => {
            const isFavori = (btn as HTMLElement).dataset.favori === 'true';
            const newState = !isFavori;
            (btn as HTMLElement).dataset.favori = newState.toString();
            btn.textContent = newState ? '⭐' : '☆';
            
            const cardId = 'card-' + (btn as HTMLElement).dataset.id;
            const card = document.getElementById(cardId) as HTMLElement;
            
            if (card && newState) {
                card.style.backgroundColor = '#fef3c7';
                card.style.border = '2px solid #f59e0b';
            } else if (card) {
                card.style.backgroundColor = 'white';
                card.style.border = '2px solid #d1d5db';
            }
        });
    });
</script>
