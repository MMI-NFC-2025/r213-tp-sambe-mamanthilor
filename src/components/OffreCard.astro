---
import PbImage from './PbImage.astro';

interface Props {
    offre: any;
}

const { offre }: Props = Astro.props;
---

<div class="offre-card rounded-xl p-4 shadow-md bg-pink-300 border-" id={"card-" + offre.id} style={offre.favori ? 'bg-pink-300; border: 2px solid #f59e0b' : 'background-color: white; border: 2px solid #d1d5db'}>
    <div class="header-card">
        <h3 class="font-bold">{offre.nomMaison}</h3>
        <button class="favori-btn" data-id={offre.id} data-favori={offre.favori?.toString() || 'false'} style="background: none; border: none; cursor: pointer; padding: 0; font-size: 24px;">
            <span class={offre.favori ? 'heart-filled' : 'heart-empty'}>
                {offre.favori ? '❤️' : '♡'}
            </span>
        </button>
    </div>
    <div class="image-container">
        {offre.images && offre.images[0] && (
            <PbImage record={offre} recordImage={offre.images[0]} width={300} height={250} />
        )}
    </div>
    <a href={`/offres/${offre.id}`} class="voir-plus-link">Voir plus</a>
</div>

<style>
    .header-card {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .heart-filled {
        filter: saturate(1) hue-rotate(-10deg) brightness(1.1);
        display: inline-block;
    }
    
    .heart-empty {
        color: #9ca3af;
        display: inline-block;
    }
    
    .image-container {
        width: 100%;
        height: 250px;
        overflow: hidden;
        border-radius: 0.5rem;
        margin-top: 1rem;
    }
    
    .image-container :global(img) {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
    
    .voir-plus-link {
        display: inline-block;
        margin-top: 1rem;
        padding: 0.5rem 1rem;
        background-color: #01183b;
        color: white;
        text-decoration: none;
        border-radius: 0.375rem;
        transition: background-color 0.3s;
    }
    
    .voir-plus-link:hover {
        background-color: #010d2c;
    }
</style>

<script>
    const buttons = document.querySelectorAll('.favori-btn') as NodeListOf<HTMLElement>;
    
    buttons.forEach(btn => {
        btn.addEventListener('click', () => {
            const isFavori = (btn as HTMLElement).dataset.favori === 'true';
            const newState = !isFavori;
            (btn as HTMLElement).dataset.favori = newState.toString();
            
            const span = btn.querySelector('span') as HTMLElement;
            span.textContent = newState ? '❤️' : '♡';
            
            if (newState) {
                span.classList.remove('heart-empty');
                span.classList.add('heart-filled');
            } else {
                span.classList.remove('heart-filled');
                span.classList.add('heart-empty');
            }
            
            const cardId = 'card-' + (btn as HTMLElement).dataset.id;
            const card = document.getElementById(cardId) as HTMLElement;
            
            if (card && newState) {
                card.style.backgroundColor = '#fef3c7';
                card.style.border = '2px solid #f59e0b';
            } else if (card) {
                card.style.backgroundColor = 'white';
                card.style.border = '2px solid #d1d5db';
            }
        });
    });
</script>
